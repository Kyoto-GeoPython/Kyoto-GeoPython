<!DOCTYPE html>
<html>
<head><meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1">

<title>Pandas―データ分析（４）ファイル入出力</title>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-115860818-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115860818-2');
</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.1.10/require.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<link rel="stylesheet" type="text/css" href="/css/notebook-000.css">
<link rel="stylesheet" type="text/css" href="/css/notebook-001.css">



<style type="text/css">
/* Overrides of notebook CSS for static HTML export */
body {
  overflow: visible;
  padding: 8px;
}

div#notebook {
  overflow: visible;
  border-top: none;
}@media print {
  div.cell {
    display: block;
    page-break-inside: avoid;
  } 
  div.output_wrapper { 
    display: block;
    page-break-inside: avoid; 
  }
  div.output { 
    display: block;
    page-break-inside: avoid; 
  }
}
</style>

<!-- Custom stylesheet, it must be in the same directory as the html file -->
<link rel="stylesheet" href="custom.css">

<!-- Loading mathjax macro -->
<!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
    MathJax.Hub.Config({
        tex2jax: {
            inlineMath: [ ['$','$'], ["\\(","\\)"] ],
            displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
            processEscapes: true,
            processEnvironments: true
        },
        // Center justify equations in code and markdown cells. Elsewhere
        // we use CSS to left justify single line equations in code cells.
        displayAlign: 'center',
        "HTML-CSS": {
            styles: {'.MathJax_Display': {"margin": 0}},
            linebreaks: { automatic: true }
        }
    });
    </script>
    <!-- End of mathjax configuration --></head>
<body>
  <div tabindex="-1" id="notebook" class="border-box-sizing">
    <div class="container" id="notebook-container">
    <h4><a href='/'>トップページに戻る</a></h4>
    <h1>Pandas―データ分析（４）ファイル入出力</h1>


<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Pandas&#12395;&#12362;&#12369;&#12427;&#12501;&#12449;&#12452;&#12523;&#20837;&#20986;&#21147;">Pandas&#12395;&#12362;&#12369;&#12427;&#12501;&#12449;&#12452;&#12523;&#20837;&#20986;&#21147;<a class="anchor-link" href="#Pandas&#12395;&#12362;&#12369;&#12427;&#12501;&#12449;&#12452;&#12523;&#20837;&#20986;&#21147;">&#182;</a></h1><p>Pandasのファイル入出力は非常に強力で、多くのファイル形式に対応しています。<br>
<a href="https://pandas.pydata.org/pandas-docs/stable/io.html">Pandas公式HP（英語）</a>を見ると、</p>
<ul>
<li>CSV</li>
<li>JSON</li>
<li>HTML</li>
<li>MS Excel</li>
<li>HDF5 Format</li>
<li>Feather Format</li>
<li>Parquet Format</li>
<li>Msgpack</li>
<li>Stata</li>
<li>SAS</li>
<li>Python Pickle Format</li>
<li>SQL</li>
<li>Google Big Query</li>
</ul>
<p>に対応していて、読み込みはもちろん、書き込みもほとんどのファイル形式でできるようです。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ファイル読み込みの代わり</span>
<span class="kn">from</span> <span class="nn">io</span> <span class="k">import</span> <span class="n">StringIO</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="CSV&#12501;&#12449;&#12452;&#12523;">CSV&#12501;&#12449;&#12452;&#12523;<a class="anchor-link" href="#CSV&#12501;&#12449;&#12452;&#12523;">&#182;</a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;col1, col2, col3</span>
<span class="s2">123, a, 9.0</span>
<span class="s2">456, b, 1.e2</span>
<span class="s2">789, c, 50.99</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[3]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>col1</th>
      <th>col2</th>
      <th>col3</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>123</td>
      <td>a</td>
      <td>9.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>456</td>
      <td>b</td>
      <td>100.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>789</td>
      <td>c</td>
      <td>50.99</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>ヘッダーがない場合は、そう言わなければなりません。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ヘッダーがない場合</span>
<span class="n">data</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;123, a, 9.0</span>
<span class="s2">456, b, 1.e2</span>
<span class="s2">789, c, 50.99</span>
<span class="s2">&quot;&quot;&quot;</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">StringIO</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">header</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>123</td>
      <td>a</td>
      <td>9.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>456</td>
      <td>b</td>
      <td>100.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>789</td>
      <td>c</td>
      <td>50.99</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>read_csv</strong>には、様々なオプション引数を与えられます。<br>
<a href="https://own-search-and-study.xyz/2015/09/03/pandas%E3%81%AEread_csv%E3%81%AE%E5%85%A8%E5%BC%95%E6%95%B0%E3%82%92%E4%BD%BF%E3%81%84%E3%81%93%E3%81%AA%E3%81%99/">Pandasのread_csvの全引数を解説</a>で、必要なオプションを設定してください。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="&#12486;&#12461;&#12473;&#12488;&#20986;&#21147;">&#12486;&#12461;&#12473;&#12488;&#20986;&#21147;<a class="anchor-link" href="#&#12486;&#12461;&#12473;&#12488;&#20986;&#21147;">&#182;</a></h3><p>出力は、<strong>to_××</strong>という名前の関数を使ってください。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># CSVに出力</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&#39;,0,1,2\n0,123, a,9.0\n1,456, b,100.0\n2,789, c,50.99\n&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># HTMLに出力</span>
<span class="n">df</span><span class="o">.</span><span class="n">to_html</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[6]:</div>




<div class="output_text output_subarea output_execute_result">
<pre>&#39;&lt;table border=&#34;1&#34; class=&#34;dataframe&#34;&gt;\n  &lt;thead&gt;\n    &lt;tr style=&#34;text-align: right;&#34;&gt;\n      &lt;th&gt;&lt;/th&gt;\n      &lt;th&gt;0&lt;/th&gt;\n      &lt;th&gt;1&lt;/th&gt;\n      &lt;th&gt;2&lt;/th&gt;\n    &lt;/tr&gt;\n  &lt;/thead&gt;\n  &lt;tbody&gt;\n    &lt;tr&gt;\n      &lt;th&gt;0&lt;/th&gt;\n      &lt;td&gt;123&lt;/td&gt;\n      &lt;td&gt;a&lt;/td&gt;\n      &lt;td&gt;9.00&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n      &lt;th&gt;1&lt;/th&gt;\n      &lt;td&gt;456&lt;/td&gt;\n      &lt;td&gt;b&lt;/td&gt;\n      &lt;td&gt;100.00&lt;/td&gt;\n    &lt;/tr&gt;\n    &lt;tr&gt;\n      &lt;th&gt;2&lt;/th&gt;\n      &lt;td&gt;789&lt;/td&gt;\n      &lt;td&gt;c&lt;/td&gt;\n      &lt;td&gt;50.99&lt;/td&gt;\n    &lt;/tr&gt;\n  &lt;/tbody&gt;\n&lt;/table&gt;&#39;</pre>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="&#12496;&#12452;&#12490;&#12522;&#20837;&#20986;&#21147;">&#12496;&#12452;&#12490;&#12522;&#20837;&#20986;&#21147;<a class="anchor-link" href="#&#12496;&#12452;&#12490;&#12522;&#20837;&#20986;&#21147;">&#182;</a></h2><h3 id="pickle">pickle<a class="anchor-link" href="#pickle">&#182;</a></h3><p>Python特有のバイナリファイル形式として、<strong>pickle</strong>というものがあります。<br>
”漬物”という意味で、その名の通り、オブジェクトを漬物のように保存することができます。<br>
解析結果をDataFrameの情報を保ったまま保存したり、それを復元したりすることができるので、解析を中断したりするときに非常に便利です。<br>
特に、Pandasのcolumnsやindex, dtypesの情報なども全て保つことができるため、もともとのDataFrameと全く同じものが復元できます。<br>
CSVといったテキストファイルに出力すると、他の人との共有する場合には適していますが、そういったメタ情報は抜け落ちてしまうため、自分だけで使用する一時的なファイルを作る場合は積極的にpickleで保存していくとよいかと思います。</p>
<h4 id="&#27880;&#24847;&#28857;">&#27880;&#24847;&#28857;<a class="anchor-link" href="#&#27880;&#24847;&#28857;">&#182;</a></h4><p>pickleはバージョンによって互換性がない場合があります。<br>
他の環境にファイルを渡す場合には、pickleファイルを使わず、テキストファイルなどを用いるようにしましょう。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>123</td>
      <td>a</td>
      <td>9.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>456</td>
      <td>b</td>
      <td>100.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>789</td>
      <td>c</td>
      <td>50.99</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>保存は<strong>to_pickle</strong>です。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">df</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s2">&quot;mydata.pickle&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>読み込みは<strong>read_pickle</strong>です。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">pd</span><span class="o">.</span><span class="n">read_pickle</span><span class="p">(</span><span class="s2">&quot;mydata.pickle&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>



<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>123</td>
      <td>a</td>
      <td>9.00</td>
    </tr>
    <tr>
      <th>1</th>
      <td>456</td>
      <td>b</td>
      <td>100.00</td>
    </tr>
    <tr>
      <th>2</th>
      <td>789</td>
      <td>c</td>
      <td>50.99</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
 


    <h4><a href='/'>トップページに戻る</a></h4>
    </div>
  </div>
</body>

 


</html>