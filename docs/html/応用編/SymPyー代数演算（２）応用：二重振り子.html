<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>SymPyー代数演算（２）応用：二重振り子</title>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=UA-115860818-2"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag() {
        dataLayer.push(arguments);
      }
      gtag("js", new Date());

      gtag("config", "UA-115860818-2");
    </script>

    <link rel="stylesheet" type="text/css" href="/css/nb-000.css" />
    <link rel="stylesheet" type="text/css" href="/css/nb-001.css" />
    <link rel="stylesheet" type="text/css" href="/css/nb-002.css" />

    <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css" />
    <link rel="stylesheet" type="text/css" href="/css/nb-base.css" />

    <!-- Loading mathjax macro -->
    <!-- Load mathjax -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS_HTML"></script>
    <!-- MathJax configuration -->
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
          tex2jax: {
              inlineMath: [ ['$','$'], ["\\(","\\)"] ],
              displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
              processEscapes: true,
              processEnvironments: true
          },
          // Center justify equations in code and markdown cells. Elsewhere
          // we use CSS to left justify single line equations in code cells.
          displayAlign: 'center',
          "HTML-CSS": {
              styles: {'.MathJax_Display': {"margin": 0}},
              linebreaks: { automatic: true }
          }
      });
    </script>
    <!-- End of mathjax configuration -->
  </head>
  <body>
    <div tabindex="-1" id="notebook" class="border-box-sizing">
      <div class="top-button-container">
        <div class="w3-panel w3-left">
          <h4><a class="w3-button w3-black" href="/">トップページに戻る</a></h4>
        </div>
      </div>

      <div class="w3-container center-container">
        <div class="container" id="notebook-container">
          <div class="w3-panel">
            <h1 class="w3-center">SymPyー代数演算（２）応用：二重振り子</h1>
          </div>

          <div class="w3-container"><div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="&#24540;&#29992;&#20363;">&#24540;&#29992;&#20363;<a class="anchor-link" href="#&#24540;&#29992;&#20363;">&#182;</a></h1><p>SymPyとNumPyの組み合わせが強力であることを示す例として、二重振り子を数値計算で解くということを試みます。<br>
もちろん普通に解いてもしょうがないので、座標設定からラグランジアン、そして運動方程式をシンボリックに求め、最後に数値計算することにします。</p>
<h3 id="&#12514;&#12487;&#12523;&#35373;&#23450;">&#12514;&#12487;&#12523;&#35373;&#23450;<a class="anchor-link" href="#&#12514;&#12487;&#12523;&#35373;&#23450;">&#182;</a></h3><p>水平にx軸、鉛直上向きにy軸があり、y軸負方向に重力がかかっています。<br>
また、原点から長さ$r_1$の棒の先に１つ目の質点がついていて、そこから長さ$r_2$の棒で２つ目の質点がつながっているとします。<br>
それぞれの棒がy軸とのなす角をそれぞれ$\theta_1, \theta_2$とします。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[1]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">sympy</span> <span class="k">as</span> <span class="nn">sy</span>
<span class="n">sy</span><span class="o">.</span><span class="n">init_printing</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[2]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="o">%</span><span class="k">matplotlib</span> qt5
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[3]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 変数と関数を定義</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;r_1 r_2 m_1 m_2 g&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># theta1, theta2 = sy.symbols(r&quot;\theta_1 \theta_2&quot;, real=True)</span>
<span class="n">theta1</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\theta_1&quot;</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span>
<span class="n">theta2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\theta_2&quot;</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span>
<span class="n">theta1_dot</span><span class="p">,</span> <span class="n">theta2_dot</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\dot{\theta_1} \dot{\theta_2}&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[4]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 質点１の位置と速度</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">r1</span> <span class="o">*</span> <span class="n">sy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">),</span> <span class="o">-</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">sy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)])</span>
<span class="n">v1</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">x1</span><span class="p">,</span> <span class="n">v1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[4]:</div>




<div class="output_latex output_subarea output_execute_result">
$$\left ( \left[\begin{matrix}r_{1} \sin{\left (\theta_{1}{\left (t \right )} \right )}\\- r_{1} \cos{\left (\theta_{1}{\left (t \right )} \right )}\end{matrix}\right], \quad \left[\begin{matrix}r_{1} \cos{\left (\theta_{1}{\left (t \right )} \right )} \frac{d}{d t} \theta_{1}{\left (t \right )}\\r_{1} \sin{\left (\theta_{1}{\left (t \right )} \right )} \frac{d}{d t} \theta_{1}{\left (t \right )}\end{matrix}\right]\right )$$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[5]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 質点２の位置と速度</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">sy</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">r2</span> <span class="o">*</span> <span class="n">sy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">),</span> <span class="o">-</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">sy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)])</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
<span class="n">x2</span><span class="p">,</span> <span class="n">v2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[5]:</div>




<div class="output_latex output_subarea output_execute_result">
$$\left ( \left[\begin{matrix}r_{1} \sin{\left (\theta_{1}{\left (t \right )} \right )} + r_{2} \sin{\left (\theta_{2}{\left (t \right )} \right )}\\- r_{1} \cos{\left (\theta_{1}{\left (t \right )} \right )} - r_{2} \cos{\left (\theta_{2}{\left (t \right )} \right )}\end{matrix}\right], \quad \left[\begin{matrix}r_{1} \cos{\left (\theta_{1}{\left (t \right )} \right )} \frac{d}{d t} \theta_{1}{\left (t \right )} + r_{2} \cos{\left (\theta_{2}{\left (t \right )} \right )} \frac{d}{d t} \theta_{2}{\left (t \right )}\\r_{1} \sin{\left (\theta_{1}{\left (t \right )} \right )} \frac{d}{d t} \theta_{1}{\left (t \right )} + r_{2} \sin{\left (\theta_{2}{\left (t \right )} \right )} \frac{d}{d t} \theta_{2}{\left (t \right )}\end{matrix}\right]\right )$$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[6]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 運動エネルギー</span>
<span class="n">T1</span> <span class="o">=</span> <span class="p">(</span><span class="n">m1</span> <span class="o">*</span> <span class="p">(</span><span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="n">T2</span> <span class="o">=</span> <span class="p">(</span><span class="n">m2</span> <span class="o">*</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="n">T1</span><span class="p">,</span> <span class="n">T2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[6]:</div>




<div class="output_latex output_subarea output_execute_result">
$$\left ( \frac{m_{1} r_{1}^{2}}{2} \left(\frac{d}{d t} \theta_{1}{\left (t \right )}\right)^{2}, \quad \frac{m_{2}}{2} \left(r_{1}^{2} \left(\frac{d}{d t} \theta_{1}{\left (t \right )}\right)^{2} + 2 r_{1} r_{2} \cos{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \frac{d}{d t} \theta_{1}{\left (t \right )} \frac{d}{d t} \theta_{2}{\left (t \right )} + r_{2}^{2} \left(\frac{d}{d t} \theta_{2}{\left (t \right )}\right)^{2}\right)\right )$$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[7]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># ポテンシャル</span>
<span class="n">V1</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">V2</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">V1</span><span class="p">,</span> <span class="n">V2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[7]:</div>




<div class="output_latex output_subarea output_execute_result">
$$\left ( - g m_{1} r_{1} \cos{\left (\theta_{1}{\left (t \right )} \right )}, \quad g m_{2} \left(- r_{1} \cos{\left (\theta_{1}{\left (t \right )} \right )} - r_{2} \cos{\left (\theta_{2}{\left (t \right )} \right )}\right)\right )$$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>運動エネルギーとポテンシャルが求まったので、ラグランジアン $L(\theta_1, \theta_2, \dot{\theta_1}, \dot{\theta_2})$ を得ることができます。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[8]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">L</span> <span class="o">=</span> <span class="n">T1</span> <span class="o">+</span> <span class="n">T2</span> <span class="o">-</span> <span class="n">V1</span> <span class="o">-</span> <span class="n">V2</span>
<span class="n">L</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[8]:</div>




<div class="output_latex output_subarea output_execute_result">
$$g m_{1} r_{1} \cos{\left (\theta_{1}{\left (t \right )} \right )} - g m_{2} \left(- r_{1} \cos{\left (\theta_{1}{\left (t \right )} \right )} - r_{2} \cos{\left (\theta_{2}{\left (t \right )} \right )}\right) + \frac{m_{1} r_{1}^{2}}{2} \left(\frac{d}{d t} \theta_{1}{\left (t \right )}\right)^{2} + \frac{m_{2}}{2} \left(r_{1}^{2} \left(\frac{d}{d t} \theta_{1}{\left (t \right )}\right)^{2} + 2 r_{1} r_{2} \cos{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \frac{d}{d t} \theta_{1}{\left (t \right )} \frac{d}{d t} \theta_{2}{\left (t \right )} + r_{2}^{2} \left(\frac{d}{d t} \theta_{2}{\left (t \right )}\right)^{2}\right)$$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>だんだん結果は複雑になってきましたが、人間側は相当楽をしています。<br>
ラグランジアンから運動方程式はそれぞれ、
$$\frac{d}{dt} \frac{\partial L}{\partial \dot{\theta_1}}=\frac{\partial L}{\partial \theta_1}$$
$$\frac{d}{dt} \frac{\partial L}{\partial \dot{\theta_2}}=\frac{\partial L}{\partial \theta_2}$$
となるので、</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[9]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 質点１の運動方程式</span>
<span class="n">EOM_1</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Eq</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">L</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span> 
<span class="n">EOM_1</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[9]:</div>




<div class="output_latex output_subarea output_execute_result">
$$m_{1} r_{1}^{2} \frac{d^{2}}{d t^{2}}  \theta_{1}{\left (t \right )} + \frac{m_{2}}{2} \left(2 r_{1}^{2} \frac{d^{2}}{d t^{2}}  \theta_{1}{\left (t \right )} - 2 r_{1} r_{2} \left(\frac{d}{d t} \theta_{1}{\left (t \right )} - \frac{d}{d t} \theta_{2}{\left (t \right )}\right) \sin{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \frac{d}{d t} \theta_{2}{\left (t \right )} + 2 r_{1} r_{2} \cos{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \frac{d^{2}}{d t^{2}}  \theta_{2}{\left (t \right )}\right) = - g m_{1} r_{1} \sin{\left (\theta_{1}{\left (t \right )} \right )} - g m_{2} r_{1} \sin{\left (\theta_{1}{\left (t \right )} \right )} - m_{2} r_{1} r_{2} \sin{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \frac{d}{d t} \theta_{1}{\left (t \right )} \frac{d}{d t} \theta_{2}{\left (t \right )}$$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[10]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 質点２の運動方程式</span>
<span class="n">EOM_2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Eq</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">L</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span> 
<span class="n">EOM_2</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[10]:</div>




<div class="output_latex output_subarea output_execute_result">
$$\frac{m_{2}}{2} \left(- 2 r_{1} r_{2} \left(\frac{d}{d t} \theta_{1}{\left (t \right )} - \frac{d}{d t} \theta_{2}{\left (t \right )}\right) \sin{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \frac{d}{d t} \theta_{1}{\left (t \right )} + 2 r_{1} r_{2} \cos{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \frac{d^{2}}{d t^{2}}  \theta_{1}{\left (t \right )} + 2 r_{2}^{2} \frac{d^{2}}{d t^{2}}  \theta_{2}{\left (t \right )}\right) = - g m_{2} r_{2} \sin{\left (\theta_{2}{\left (t \right )} \right )} + m_{2} r_{1} r_{2} \sin{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \frac{d}{d t} \theta_{1}{\left (t \right )} \frac{d}{d t} \theta_{2}{\left (t \right )}$$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>$\ddot{\theta_1}, \ddot{\theta_2}$について解くと、</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[11]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">EOMs</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">solve</span><span class="p">([</span><span class="n">EOM_1</span><span class="p">,</span> <span class="n">EOM_2</span><span class="p">],</span> <span class="p">(</span><span class="n">theta1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">theta2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>
<span class="n">EOMs</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">


<div class="output_area">

    <div class="prompt output_prompt">Out[11]:</div>




<div class="output_latex output_subarea output_execute_result">
$$\left \{ \frac{d^{2}}{d t^{2}}  \theta_{1}{\left (t \right )} : \frac{1}{r_{1} \left(- m_{1} + m_{2} \cos^{2}{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} - m_{2}\right)} \left(g m_{1} \sin{\left (\theta_{1}{\left (t \right )} \right )} + \frac{g m_{2}}{2} \sin{\left (\theta_{1}{\left (t \right )} - 2 \theta_{2}{\left (t \right )} \right )} + \frac{g m_{2}}{2} \sin{\left (\theta_{1}{\left (t \right )} \right )} + \frac{m_{2} r_{1}}{2} \sin{\left (2 \theta_{1}{\left (t \right )} - 2 \theta_{2}{\left (t \right )} \right )} \left(\frac{d}{d t} \theta_{1}{\left (t \right )}\right)^{2} + m_{2} r_{2} \sin{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \left(\frac{d}{d t} \theta_{2}{\left (t \right )}\right)^{2}\right), \quad \frac{d^{2}}{d t^{2}}  \theta_{2}{\left (t \right )} : \frac{1}{r_{2} \left(- m_{1} + m_{2} \cos^{2}{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} - m_{2}\right)} \left(\left(m_{1} + m_{2}\right) \left(g \sin{\left (\theta_{2}{\left (t \right )} \right )} - r_{1} \sin{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \left(\frac{d}{d t} \theta_{1}{\left (t \right )}\right)^{2}\right) - \left(g m_{1} \sin{\left (\theta_{1}{\left (t \right )} \right )} + g m_{2} \sin{\left (\theta_{1}{\left (t \right )} \right )} + m_{2} r_{2} \sin{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )} \left(\frac{d}{d t} \theta_{2}{\left (t \right )}\right)^{2}\right) \cos{\left (\theta_{1}{\left (t \right )} - \theta_{2}{\left (t \right )} \right )}\right)\right \}$$
</div>

</div>

</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[12]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 関数を変数に置き換える</span>
<span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\theta_1 \theta_2&quot;</span><span class="p">)</span>
<span class="n">diff2dot</span> <span class="o">=</span> <span class="p">[(</span><span class="n">theta1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">theta1_dot</span><span class="p">),</span>
            <span class="p">(</span><span class="n">theta2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">theta2_dot</span><span class="p">)]</span>
<span class="n">theta1_ddot</span> <span class="o">=</span> <span class="n">EOMs</span><span class="p">[</span><span class="n">theta1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">diff2dot</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">t1</span><span class="p">),</span> <span class="p">(</span><span class="n">theta2</span><span class="p">,</span> <span class="n">t2</span><span class="p">)])</span>
<span class="n">theta2_ddot</span> <span class="o">=</span> <span class="n">EOMs</span><span class="p">[</span><span class="n">theta2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">diff2dot</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">t1</span><span class="p">),</span> <span class="p">(</span><span class="n">theta2</span><span class="p">,</span> <span class="n">t2</span><span class="p">)])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[13]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># NumPyの関数に変換する</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">theta1_dot</span><span class="p">,</span> <span class="n">theta2_dot</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
<span class="n">func1</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">theta1_ddot</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">)</span>
<span class="n">func2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">theta2_ddot</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[15]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 数値計算</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">ode</span>

<span class="k">def</span> <span class="nf">time_evolve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">theta1_dot</span><span class="p">,</span> <span class="n">theta2_dot</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">theta1_dot</span><span class="p">,</span> <span class="n">theta2_dot</span><span class="p">,</span>
            <span class="n">func1</span><span class="p">(</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">),</span>
            <span class="n">func2</span><span class="p">(</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">)]</span>

<span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;m1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;m2&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;r1&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="mf">9.8</span><span class="p">}</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">ode</span><span class="p">(</span><span class="n">time_evolve</span><span class="p">)</span><span class="o">.</span><span class="n">set_initial_value</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_f_params</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.01</span>
<span class="n">tmax</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="n">solver</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">solver</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">y</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[16]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;theta1&quot;</span><span class="p">,</span> <span class="s2">&quot;theta2&quot;</span><span class="p">,</span> <span class="s2">&quot;theta1_dot&quot;</span><span class="p">,</span> <span class="s2">&quot;theta2_dot&quot;</span><span class="p">])</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;r1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">theta1</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;x2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">x1</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">theta2</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;r1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">theta1</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">y1</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">theta2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[17]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.animation</span> <span class="k">as</span> <span class="nn">animation</span>
<span class="kn">import</span> <span class="nn">matplotlib.patches</span> <span class="k">as</span> <span class="nn">patches</span>

<span class="k">def</span> <span class="nf">gen</span><span class="p">():</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">vals</span> <span class="ow">in</span> <span class="n">results</span><span class="p">[[</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;x1&quot;</span><span class="p">,</span> <span class="s2">&quot;x2&quot;</span><span class="p">,</span> <span class="s2">&quot;y1&quot;</span><span class="p">,</span> <span class="s2">&quot;y2&quot;</span><span class="p">]]</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
        <span class="k">yield</span> <span class="n">vals</span><span class="o">.</span><span class="n">values</span>

<span class="k">def</span> <span class="nf">plot_double_pendulum</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">t</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">y2</span> <span class="o">=</span> <span class="n">data</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">cla</span><span class="p">()</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;r1&quot;</span><span class="p">]</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">]</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">(</span><span class="o">-</span><span class="n">R</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">],</span> <span class="p">[</span><span class="n">y1</span><span class="p">,</span> <span class="n">y2</span><span class="p">])</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Arrow</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">add_patch</span><span class="p">(</span><span class="n">patches</span><span class="o">.</span><span class="n">Arrow</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">y1</span><span class="p">,</span> <span class="p">(</span><span class="n">x2</span><span class="o">-</span><span class="n">x1</span><span class="p">),</span> <span class="p">(</span><span class="n">y2</span><span class="o">-</span><span class="n">y1</span><span class="p">),</span> <span class="n">width</span><span class="o">=</span><span class="mf">0.01</span><span class="p">))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_aspect</span><span class="p">(</span><span class="s2">&quot;equal&quot;</span><span class="p">)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
<span class="n">ani</span> <span class="o">=</span> <span class="n">animation</span><span class="o">.</span><span class="n">FuncAnimation</span><span class="p">(</span><span class="n">fig</span><span class="p">,</span> <span class="n">plot_double_pendulum</span><span class="p">,</span> <span class="n">gen</span><span class="p">,</span> <span class="n">interval</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">save_count</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span>
<span class="c1"># ani.save(&quot;double_pendulum.gif&quot;, writer=&quot;imagemagick&quot;, dpi=100)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="double_pendulum.gif"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="prompt input_prompt">
</div><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h3 id="&#12414;&#12392;&#12417;&#12427;&#12392;">&#12414;&#12392;&#12417;&#12427;&#12392;<a class="anchor-link" href="#&#12414;&#12392;&#12417;&#12427;&#12392;">&#182;</a></h3><p>一つのセルにまとめると以下のように書けます。</p>

</div>
</div>
</div>
<div class="cell border-box-sizing code_cell rendered">
<div class="input">
<div class="prompt input_prompt">In&nbsp;[18]:</div>
<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="c1"># 変数と関数を定義</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Symbol</span><span class="p">(</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="n">real</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">g</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;r_1 r_2 m_1 m_2 g&quot;</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="c1"># theta1, theta2 = sy.symbols(r&quot;\theta_1 \theta_2&quot;, real=True)</span>
<span class="n">theta1</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\theta_1&quot;</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span>
<span class="n">theta2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Function</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\theta_2&quot;</span><span class="p">)(</span><span class="n">t</span><span class="p">)</span>
<span class="n">theta1_dot</span><span class="p">,</span> <span class="n">theta2_dot</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\dot{\theta_1} \dot{\theta_2}&quot;</span><span class="p">)</span>

<span class="c1"># 質点１の位置と速度</span>
<span class="n">x1</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">r1</span> <span class="o">*</span> <span class="n">sy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta1</span><span class="p">),</span> <span class="o">-</span> <span class="n">r1</span> <span class="o">*</span> <span class="n">sy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta1</span><span class="p">)])</span>
<span class="n">v1</span> <span class="o">=</span> <span class="n">x1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># 質点２の位置と速度</span>
<span class="n">x2</span> <span class="o">=</span> <span class="n">x1</span> <span class="o">+</span> <span class="n">sy</span><span class="o">.</span><span class="n">Matrix</span><span class="p">([</span><span class="n">r2</span> <span class="o">*</span> <span class="n">sy</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta2</span><span class="p">),</span> <span class="o">-</span> <span class="n">r2</span> <span class="o">*</span> <span class="n">sy</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta2</span><span class="p">)])</span>
<span class="n">v2</span> <span class="o">=</span> <span class="n">x2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>

<span class="c1"># 運動エネルギー</span>
<span class="n">T1</span> <span class="o">=</span> <span class="p">(</span><span class="n">m1</span> <span class="o">*</span> <span class="p">(</span><span class="n">v1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>
<span class="n">T2</span> <span class="o">=</span> <span class="p">(</span><span class="n">m2</span> <span class="o">*</span> <span class="p">(</span><span class="n">v2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">v2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">simplify</span><span class="p">()</span>

<span class="c1"># ポテンシャル</span>
<span class="n">V1</span> <span class="o">=</span> <span class="n">m1</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">x1</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">V2</span> <span class="o">=</span> <span class="n">m2</span> <span class="o">*</span> <span class="n">g</span> <span class="o">*</span> <span class="n">x2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

<span class="c1"># ラグランジアン</span>
<span class="n">L</span> <span class="o">=</span> <span class="n">T1</span> <span class="o">+</span> <span class="n">T2</span> <span class="o">-</span> <span class="n">V1</span> <span class="o">-</span> <span class="n">V2</span>

<span class="c1"># 質点１、２の運動方程式</span>
<span class="n">EOM_1</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Eq</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">L</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta1</span><span class="p">))</span> 
<span class="n">EOM_2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">Eq</span><span class="p">(</span><span class="n">L</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">))</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">L</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">theta2</span><span class="p">))</span> 

<span class="c1"># 加速度について解く</span>
<span class="n">EOMs</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">solve</span><span class="p">([</span><span class="n">EOM_1</span><span class="p">,</span> <span class="n">EOM_2</span><span class="p">],</span> <span class="p">(</span><span class="n">theta1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="n">theta2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">)))</span>

<span class="c1"># 関数を変数に変換</span>
<span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">symbols</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\theta_1 \theta_2&quot;</span><span class="p">)</span>
<span class="n">diff2dot</span> <span class="o">=</span> <span class="p">[(</span><span class="n">theta1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">theta1_dot</span><span class="p">),</span>
            <span class="p">(</span><span class="n">theta2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">),</span> <span class="n">theta2_dot</span><span class="p">)]</span>
<span class="n">theta1_ddot</span> <span class="o">=</span> <span class="n">EOMs</span><span class="p">[</span><span class="n">theta1</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">diff2dot</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">t1</span><span class="p">),</span> <span class="p">(</span><span class="n">theta2</span><span class="p">,</span> <span class="n">t2</span><span class="p">)])</span>
<span class="n">theta2_ddot</span> <span class="o">=</span> <span class="n">EOMs</span><span class="p">[</span><span class="n">theta2</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="mi">2</span><span class="p">)]</span><span class="o">.</span><span class="n">subs</span><span class="p">(</span><span class="n">diff2dot</span><span class="p">)</span><span class="o">.</span><span class="n">subs</span><span class="p">([(</span><span class="n">theta1</span><span class="p">,</span> <span class="n">t1</span><span class="p">),</span> <span class="p">(</span><span class="n">theta2</span><span class="p">,</span> <span class="n">t2</span><span class="p">)])</span>

<span class="c1"># NumPy関数化</span>
<span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">,</span> <span class="n">theta1_dot</span><span class="p">,</span> <span class="n">theta2_dot</span><span class="p">,</span> <span class="n">m1</span><span class="p">,</span> <span class="n">m2</span><span class="p">,</span> <span class="n">r1</span><span class="p">,</span> <span class="n">r2</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
<span class="n">func1</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">theta1_ddot</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">)</span>
<span class="n">func2</span> <span class="o">=</span> <span class="n">sy</span><span class="o">.</span><span class="n">lambdify</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">theta2_ddot</span><span class="p">,</span> <span class="s2">&quot;numpy&quot;</span><span class="p">)</span>

<span class="c1"># 数値計算</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">ode</span>

<span class="k">def</span> <span class="nf">time_evolve</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">params</span><span class="p">):</span>
    <span class="n">theta1</span><span class="p">,</span> <span class="n">theta2</span><span class="p">,</span> <span class="n">theta1_dot</span><span class="p">,</span> <span class="n">theta2_dot</span> <span class="o">=</span> <span class="n">y</span>
    <span class="k">return</span> <span class="p">[</span><span class="n">theta1_dot</span><span class="p">,</span> <span class="n">theta2_dot</span><span class="p">,</span>
            <span class="n">func1</span><span class="p">(</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">),</span>
            <span class="n">func2</span><span class="p">(</span><span class="o">*</span><span class="n">y</span><span class="p">,</span> <span class="o">*</span><span class="n">params</span><span class="p">)]</span>

<span class="c1"># 初期値</span>
<span class="n">y0</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="mf">1.01</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">]</span>
<span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;m1&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;m2&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s2">&quot;r1&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;r2&quot;</span><span class="p">:</span> <span class="mf">0.1</span><span class="p">,</span> <span class="s2">&quot;g&quot;</span><span class="p">:</span> <span class="mf">9.8</span><span class="p">}</span>
<span class="n">solver</span> <span class="o">=</span> <span class="n">ode</span><span class="p">(</span><span class="n">time_evolve</span><span class="p">)</span><span class="o">.</span><span class="n">set_initial_value</span><span class="p">(</span><span class="n">y0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">set_f_params</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">dt</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">tmax</span> <span class="o">=</span> <span class="mi">50</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">while</span> <span class="n">solver</span><span class="o">.</span><span class="n">t</span> <span class="o">&lt;</span> <span class="n">tmax</span><span class="p">:</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">solver</span><span class="o">.</span><span class="n">integrate</span><span class="p">(</span><span class="n">solver</span><span class="o">.</span><span class="n">t</span> <span class="o">+</span> <span class="n">dt</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">solver</span><span class="o">.</span><span class="n">t</span><span class="p">,</span> <span class="o">*</span><span class="n">y</span><span class="p">])</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;t&quot;</span><span class="p">,</span> <span class="s2">&quot;theta1&quot;</span><span class="p">,</span> <span class="s2">&quot;theta2&quot;</span><span class="p">,</span> <span class="s2">&quot;theta1_dot&quot;</span><span class="p">,</span> <span class="s2">&quot;theta2_dot&quot;</span><span class="p">])</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;x1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;r1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">theta1</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;x2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">x1</span> <span class="o">+</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">theta2</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;y1&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="n">params</span><span class="p">[</span><span class="s2">&quot;r1&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">theta1</span><span class="p">)</span>
<span class="n">results</span><span class="p">[</span><span class="s2">&quot;y2&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">y1</span> <span class="o">-</span> <span class="n">params</span><span class="p">[</span><span class="s2">&quot;r2&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">results</span><span class="o">.</span><span class="n">theta2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
 

</div>
        </div>
      </div>

      <div class="w3-row-padding w3-padding w3-left-aligned w3-panel">
        <div class="w3-half w3-padding w3-container">
          <h2 class="w3-xxlarge w3-padding w3-blue">基礎編</h2>
          <div class="w3-padding">
            <p>
              <a href="/html/基礎編/Pythonの基礎1.html">Pythonの基礎（１）</a>
            </p>
            <p>
              <a href="/html/基礎編/Pythonの基礎2.html">Pythonの基礎（２）</a>
            </p>
            <p><a href="/html/基礎編/Matplotlib.html">Matplotlib</a></p>
            <p>
              <a href="/html/基礎編/Numpyの基礎（１）導入.html"
                >Numpyの基礎 ― 導入</a
              >
            </p>
            <p>
              <a href="/html/基礎編/Numpyの基礎（２）生成関数.html"
                >Numpyの基礎 ― 生成関数</a
              >
            </p>
            <p>
              <a href="/html/基礎編/Numpyの基礎（３）ufunc.html"
                >Numpyの基礎 ― 配列に関数を作用させる</a
              >
            </p>
            <p>
              <a href="/html/基礎編/Numpyの基礎（４）データ型.html"
                >Numpyの基礎 ― データ型（C,Fortranとの比較）</a
              >
            </p>
            <p>
              <a href="/html/基礎編/Numpyの基礎（５）要素の参照.html"
                >Numpyの基礎 ― 要素の取り出し方</a
              >
            </p>
            <p>
              <a href="/html/基礎編/Numpyの基礎（６）ブロードキャスト.html"
                >Numpyの基礎 ― ブロードキャスト</a
              >
            </p>
            <p>
              <a href="/html/基礎編/Numpyの基礎（７）便利なライブラリ群.html"
                >Numpyの基礎 ― 線形代数やフーリエ変換</a
              >
            </p>
            <p>
              <a href="/html/基礎編/Numpyの基礎（８）ファイル入出力.html"
                >Numpyの基礎 ― 様々な形式に対応したファイル入出力</a
              >
            </p>
            <p>
              <a href="/html/基礎編/ファイル読み込み.html">ファイル読み込み</a>
            </p>
            <p>
              <a href="/html/基礎編/文字列操作（１）str.format.html"
                >文字列操作 ― 数値を文字列にフォーマットする</a
              >
            </p>
            <p>
              <a href="/html/基礎編/文字列操作（２）strやファイル読み込み.html"
                >文字列操作 ― 文字列に関数を適用する</a
              >
            </p>
            <p>
              <a href="/html/基礎編/読みやすいPythonコードを書こう.html"
                >読みやすいPythonコードを書こう</a
              >
            </p>
          </div>
        </div>
        <div class="w3-half w3-padding w3-container">
          <h2 class="w3-xxlarge w3-padding w3-orange">応用編</h2>
          <div class="w3-padding">
            <p><a href="/html/応用編/Animation.html">Animation</a></p>
            <p>
              <a href="/html/応用編/Fortran, C言語 との連携.html"
                >Fortran, C言語 との連携</a
              >
            </p>
            <p>
              <a href="/html/応用編/Pandas―データ分析（１）Series.html"
                >Pandas ― データ分析（１）時系列などをうまく扱えるようにする</a
              >
            </p>
            <p>
              <a href="/html/応用編/Pandas―データ分析（２）DataFrame.html"
                >Pandas ―
                データ分析（２）複数の列を持った表形式でデータを格納する</a
              >
            </p>
            <p>
              <a href="/html/応用編/Pandas―データ分析（３）GroupBy.html"
                >Pandas ― データ分析（３）データを分割し、個別に集計する</a
              >
            </p>
            <p>
              <a href="/html/応用編/Pandas―データ分析（４）ファイル入出力.html"
                >Pandas ― データ分析（４）高度なファイル入出力</a
              >
            </p>
            <p>
              <a
                href="/html/応用編/Pandas―データ分析（５）応用：都道府県別人口推移.html"
                >Pandas ― データ分析（５）応用：都道府県別人口推移</a
              >
            </p>
            <p>
              <a
                href="/html/応用編/Seaborn ― matplotlib をより美しく、使いやすく.html"
                >Seaborn ― matplotlib をより美しく、使いやすく</a
              >
            </p>
            <p>
              <a href="/html/応用編/shやBashの代わりにPythonを使う.html"
                >shやBashの代わりにPythonを使う</a
              >
            </p>
            <p>
              <a href="/html/応用編/SymPyー代数演算（１）使い方.html"
                >SymPy ― 代数演算（１）文字を文字のまま計算する</a
              >
            </p>
            <p>
              <a href="/html/応用編/SymPyー代数演算（２）応用：二重振り子.html"
                >SymPy ―
                代数演算（２）応用：ラグランジアンから運動方程式を求めて二重振り子を解く</a
              >
            </p>
          </div>
        </div>
      </div>

      <div class="footer-button-container">
        <div class="w3-panel w3-center">
          <h4><a class="w3-button w3-black" href="/">トップページに戻る</a></h4>
        </div>
      </div>
    </div>
  </body>
</html>